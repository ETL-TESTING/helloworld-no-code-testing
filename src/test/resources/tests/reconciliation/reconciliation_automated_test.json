{
    "scenarioName": "PROCESS AND TEST RECONCILIATION END TO END RECON @Syed #PreProd",
    "steps": [
        {
            "name": "create_recon_db_schema",
            "url": "db://MagicExecutor",
            "operation": "EXECUTE",
            "request": {
                "sql": "${SQL.FILE:sql/ddl.sql}"
            },
            "verify": {}
        },
        {
            "name": "load_source_csv_extract",
            "url": "db://MagicExecutor",
            "operation": "LOADCSV",
            "request": {
                "tableName": "source_customer",
                "csvSource": "data/source_customer.csv",
                "withHeaders": true
            },
            "verify": {
                "size": 2
            }
        },
        {
            "name": "check_loaded_source_data_count",
            "url": "db://MagicExecutor",
            "operation": "EXECUTE",
            "request": {
                "sql": "SELECT ID, EMAIL FROM stagingrepdb.recon.source_customer ORDER BY ID"
            },
            "verify": {
                "rows.SIZE": "(int)${$.load_source_csv_extract.response.size}"
            }
        },
        {
            "name": "load_target_csv_extract",
            "url": "db://MagicExecutor",
            "operation": "LOADCSV",
            "request": {
                "tableName": "target_persons",
                "csvSource": "data/target_persons.csv",
                "withHeaders": true
            },
            "verify": {
                "size": 2
            }
        },
        {
            "name": "check_loaded_target_data_count",
            "url": "db://MagicExecutor",
            "operation": "EXECUTE",
            "request": {
                "sql": "SELECT ID, EMAIL FROM stagingrepdb.recon.target_persons ORDER BY ID"
            },
            "verify": {
                "rows.SIZE": "(int)${$.load_target_csv_extract.response.size}"
            }
        },
        {
            "name": "run_full_reconciliation_process",
            "url": "db://MagicExecutor",
            "operation": "EXECUTE",
            "request": {
                "sql": "${SQL.FILE:sql/full_reconciliation.sql}"
            },
            "verify": {
                "rows": [
                    {"check_type": "Email Mismatches", "source_count": 0, "target_count": 0, "status": "PASS"},
                    {"check_type": "Extra in Target", "source_count": 0, "target_count": 0, "status": "PASS"},
                    {"check_type": "Missing in Target", "source_count": 0, "target_count": 0, "status": "PASS"},
                    {"check_type": "Record Count Check", "source_count": 2, "target_count": 2, "status": "PASS"}
                ]
            }
        }
    ]
}